<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&P 500 vs IUL 专业对比工具</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #10b981;
            --accent: #ef4444;
            --bg: #f8fafc;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 10px;
            color: #1e293b;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.8rem;
            font-weight: bold;
            color: #64748b;
            margin-bottom: 4px;
        }

        input,
        select {
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            grid-column: span 2;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .sp-card {
            border-left-color: var(--accent);
        }

        .iul-card {
            border-left-color: var(--secondary);
        }

        .chart-container {
            height: 400px;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        th,
        td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            text-align: center;
        }

        th {
            background: #f8fafc;
            position: sticky;
            top: 0;
        }

        .btn-compare {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h2 id="txtTitle">S&P 500 (征税) vs IUL (免税)</h2>
            <select id="langSelect" onchange="updateUI()">
                <option value="zh">简体中文</option>
                <option value="zh-tw">繁體中文</option>
                <option value="en">English</option>
            </select>
        </header>

        <div class="controls">
            <div class="input-group"><label id="txtStart">开始年份</label><input type="number" id="startYear" value="1995">
            </div>
            <div class="input-group"><label id="txtEnd">结束年份</label><input type="number" id="endYear" value="2025">
            </div>
            <div class="input-group"><label id="txtFloor">IUL 保底 (%)</label><input type="number" id="floor" value="0">
            </div>
            <div class="input-group"><label id="txtCap">IUL 封顶 (%)</label><input type="number" id="cap" value="12">
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="taxEnable" checked onchange="updateUI()">
                <label id="txtTaxEnable" for="taxEnable" style="cursor:pointer">考虑 S&P 500 年度税收</label>
            </div>
            <div class="input-group" id="taxGroup">
                <label id="txtTaxRate">资本利得税率 (%)</label>
                <input type="number" id="taxRate" value="20">
            </div>

            <div class="input-group">
                <label id="txtCOI">IUL 年度保险成本 ($)</label>
                <input type="number" id="coiRate" value="500">
            </div>
        </div>

        <button class="btn-compare" id="btnRun" onclick="runAnalysis()">开始对比计算</button>

        <div class="summary-grid">
            <div class="summary-card sp-card">
                <strong id="txtSPName">S&P 500 (税后)</strong>
                <div id="spStats">--</div>
            </div>
            <div class="summary-card iul-card">
                <strong id="txtIULName">IUL 指数险</strong>
                <div id="iulStats">--</div>
            </div>
        </div>

        <div class="chart-container"><canvas id="mainChart"></canvas></div>

        <table>
            <thead>
                <tr>
                    <th id="thYear">年份</th>
                    <th id="thSPRaw">S&P 500 (原始 %)</th>
                    <th id="thSPNet">S&P 500 (税后 %)</th>
                    <th id="thSPVal">S&P 500 余额 ($)</th>
                    <th id="thIUL">IUL 利率 (%)</th>
                    <th id="thIULVal">IUL 余额 ($)</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        // 历史数据
        const spData = { 1928: 43.6, 1929: -8.4, 1930: -24.9, 1931: -43.3, 1932: -8.2, 1933: 54, 1934: -1.4, 1935: 41.4, 1936: 27.9, 1937: -38.6, 1938: 25.2, 1939: -5.5, 1940: -15.3, 1941: -17.9, 1942: 12.4, 1943: 19.5, 1944: 13.8, 1945: 30.7, 1946: -11.9, 1947: 0, 1948: -0.7, 1949: 10.3, 1950: 21.8, 1951: 16.5, 1952: 11.8, 1953: -6.6, 1954: 45, 1955: 26.4, 1956: 2.6, 1957: -14.3, 1958: 38.1, 1959: 8.5, 1960: -3, 1961: 23.1, 1962: -11.8, 1963: 18.9, 1964: 13, 1965: 9.1, 1966: -13.1, 1967: 20.1, 1968: 7.7, 1969: -11.4, 1970: 0.1, 1971: 10.8, 1972: 15.6, 1973: -17.4, 1974: -29.7, 1975: 31.6, 1976: 19.2, 1977: -11.5, 1978: 1.1, 1979: 12.3, 1980: 25.8, 1981: -9.7, 1982: 14.8, 1983: 17.3, 1984: 1.4, 1985: 26.3, 1986: 14.6, 1987: 2, 1988: 12.4, 1989: 27.3, 1990: -6.6, 1991: 26.3, 1992: 4.5, 1993: 7.1, 1994: -1.5, 1995: 34.1, 1996: 20.3, 1997: 31, 1998: 26.7, 1999: 19.5, 2000: -10.1, 2001: -13, 2002: -23.4, 2003: 26.4, 2004: 9, 2005: 3, 2006: 13.6, 2007: 3.5, 2008: -38.5, 2009: 23.5, 2010: 12.8, 2011: 0, 2012: 13.4, 2013: 29.6, 2014: 11.4, 2015: -0.7, 2016: 9.5, 2017: 19.4, 2018: -6.2, 2019: 28.9, 2020: 16.3, 2021: 26.9, 2022: -19.4, 2023: 24.2, 2024: 23.3, 2025: 16.4 };

        const i18n = {
            zh: { title: "S&P 500 (征税) vs IUL (免税)", start: "开始年份", end: "结束年份", floor: "保底 (%)", cap: "封顶 (%)", tax: "考虑 S&P 500 税收", taxRate: "年度税率 (%)", coi: "IUL 年度保险成本 ($)", btn: "开始对比计算", total: "最终总额", cagr: "复合年化", year: "年份", sp: "S&P 500" },
            en: { title: "S&P 500 (Taxable) vs IUL (Tax-Free)", start: "Start Year", end: "End Year", floor: "Floor (%)", cap: "Cap (%)", tax: "Consider S&P Tax", taxRate: "Tax Rate (%)", coi: "IUL Annual COI ($)", btn: "Run Comparison", total: "Ending Balance", cagr: "CAGR", year: "Year", sp: "S&P 500" }
        };

        let myChart = null;

        function updateUI() {
            const l = i18n[document.getElementById('langSelect').value] || i18n.zh;
            document.getElementById('txtTitle').innerText = l.title;
            document.getElementById('txtStart').innerText = l.start;
            document.getElementById('txtEnd').innerText = l.end;
            document.getElementById('txtFloor').innerText = l.floor;
            document.getElementById('txtCap').innerText = l.cap;
            document.getElementById('txtTaxEnable').innerText = l.tax;
            document.getElementById('txtTaxRate').innerText = l.taxRate;
            document.getElementById('txtCOI').innerText = l.coi;
            document.getElementById('btnRun').innerText = l.btn;
            document.getElementById('thYear').innerText = l.year;
        }

        function runAnalysis() {
            const start = parseInt(document.getElementById('startYear').value);
            const end = parseInt(document.getElementById('endYear').value);
            const floor = parseFloat(document.getElementById('floor').value);
            const cap = parseFloat(document.getElementById('cap').value);
            const taxRate = parseFloat(document.getElementById('taxRate').value) / 100;
            const isTaxed = document.getElementById('taxEnable').checked;
            const coi = parseFloat(document.getElementById('coiRate').value);

            let spVal = 10000;
            let iulVal = 10000;
            let years = [start - 1], spHistory = [10000], iulHistory = [10000];
            const body = document.getElementById('tableBody');
            body.innerHTML = '';

            for (let y = start; y <= end; y++) {
                if (spData[y] === undefined) continue;

                // --- S&P 500 计算 ---
                let sRet = spData[y];
                // 仅对正收益征税 (简化模型：亏损年份不抵税)
                let netSRet = (isTaxed && sRet > 0) ? (sRet * (1 - taxRate)) : sRet;
                spVal *= (1 + netSRet / 100);

                // --- IUL 计算 ---
                let iRet = Math.max(floor, Math.min(cap, sRet));
                iulVal = (iulVal * (1 + iRet / 100)) - coi;
                if (iulVal < 0) iulVal = 0;

                years.push(y);
                spHistory.push(spVal.toFixed(2));
                iulHistory.push(iulVal.toFixed(2));

                // 插入表格行
                body.innerHTML += `<tr>
            <td>${y}</td>
            <td>${sRet}%</td>
            <td style="color:var(--accent)">${netSRet.toFixed(2)}%</td>
            <td style="font-weight:bold">$${Math.round(spVal).toLocaleString()}</td>
            <td style="color:var(--secondary)">${iRet}%</td>
            <td style="font-weight:bold">$${Math.round(iulVal).toLocaleString()}</td>
        </tr>`;
            }

            // 更新 CAGR 和图表
            const n = years.length - 1;
            const spCAGR = (Math.pow(spVal / 10000, 1 / n) - 1) * 100;
            const iulCAGR = (Math.pow(iulVal / 10000, 1 / n) - 1) * 100;

            document.getElementById('spStats').innerHTML = `最终余额: $${Math.round(spVal).toLocaleString()}<br>税后年化: ${spCAGR.toFixed(2)}%`;
            document.getElementById('iulStats').innerHTML = `最终余额: $${Math.round(iulVal).toLocaleString()}<br>扣费后年化: ${iulCAGR.toFixed(2)}%`;

            drawChart(years, spHistory, iulHistory);
        }

        function drawChart(labels, sp, iul) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'S&P 500 (税后 $)', data: sp, borderColor: '#ef4444', borderWidth: 2, pointRadius: 0 },
                        { label: 'IUL (扣费后 $)', data: iul, borderColor: '#10b981', borderWidth: 3, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: { y: { ticks: { callback: v => '$' + v.toLocaleString() } } }
                }
            });
        }

        updateUI();
        runAnalysis();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>
    <link rel="manifest" href="manifest.json">
</body>

</html>